# /etc/udev/rules.d/99-netnotes.rules
# Provide controlled access to HID/USB devices for the 'netnotes' group.
# This rule is intentionally conservative: it matches HID interfaces (class 0x03)
# and raw hidraw devices. Adjust vendor/product or serial selectors below if you
# want to limit access to specific devices.

# USB HID Interfaces (Boot Protocol keyboards/mice)
SUBSYSTEM=="usb", ATTRS{bInterfaceClass}=="03", MODE="0660", GROUP="netnotes"

# Raw HID devices (hidraw nodes)
SUBSYSTEM=="hidraw", KERNEL=="hidraw*", MODE="0660", GROUP="netnotes"

# Optional: restrict by vendor/product or serial (example)
# SUBSYSTEM=="usb", ATTR{idVendor}=="abcd", ATTR{idProduct}=="1234", MODE="0660", GROUP="netnotes"

# Notes / Installation
# 1. Create a dedicated system group and user for the daemon (if not present):
#    sudo groupadd --system netnotes
#    sudo useradd --system --group netnotes --home /var/lib/netnotes --shell /usr/sbin/nologin netnotes
#
# 2. Add admin users who should manage devices into the netnotes group:
#    sudo usermod -a -G netnotes <your-user>
#
# 3. Copy this file to /etc/udev/rules.d/99-netnotes.rules and reload:
#    sudo cp 99-netnotes.rules /etc/udev/rules.d/
#    sudo udevadm control --reload-rules
#    sudo udevadm trigger
#
# 4. Use systemd unit (note-daemon.service) configured to run as the 'netnotes'
#    user; that reduces the need to run the daemon as root while keeping access
#    to the specific device nodes via the group.

# 5. Verify permissions:
#    ls -l /dev/bus/usb/*/*
#    ls -l /dev/hidraw*
#    # Device nodes should be group-owned by 'netnotes' and mode 0660